<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claculator</title>

        <style>
            :root {
                --bg:#0f0f0f;
                --card:#1a1a1a;
                --muted:#a8a8a8;
                --accent:#00ff99;
                --danger:#ff5555;
                --btn:#333;
            }
            *{box-sizing: border-box;}

            body {
                margin: 0;
                min-height: 100vh;
                display: flex;
                align-items: center;
                justify-content: center;
                font-family: Inter, system-ui, Arial;

            background: linear-gradient(180deg,var(--bg),#071014 140%);
                color: #fff;
                padding: 20px;
            }

            .calculator {
                width: 100%;
                max-width: 360px;
                background: var(--card);
                border-radius: 14px;
                padding: 18px;
                box-shadow: 0 8px 30px
            rgba(0,0,0,0.6);
                border: 1px solid rgba(255,255,255,0.03)
            
            }

            #display {
                width: 100%;
                height: 64px;
                font-size: 28px;
                background: #000;
                color: var(--accent);
                border-radius: 12px;
                border: none;
                outline: none;
                text-align: right;
                letter-spacing: 0,6px;
            }

            .top-row {
                display: flex;
                gap: 10px;
                margin: 12px 0 18px;
            }
            .small-btn {
                flex: 1;
                padding: 10px 8px;
                border-radius: 10px;
                background: var(--btn);
                border: none;
                color: #fff;
                font-weight: 600;
                cursor: pointer;
            }

            .small-btn.danger {
                background: var(--danger);
                color: #111;
            }
            .small-btn.alt {
                background: transparent;
                border: 1px solid rgba(255, 255, 255, 0.06);
                color: var(--muted);
            }

            .buttons {
                display: grid;
                grid-template-columns: repeat(4,1fr);
                gap: 10px;
            }

            button.key {
                padding: 18px;
                font-size: 18px;
                border-radius: 10px;
                border: none;
                background: var(--btn);
                color: white;
                cursor: pointer;
                transition: transform .08 ease, background .12s ease;
                user-select: none;
            }

            button.key:active {
                transform: scale(.98); }
            button.key.op { background: linear-gradient(180deg,#0f6 0%, #00ff99 100%);
                color: #071014;
                font-weight: 700;
            }
            button.key.equal { grid-column: span 2;
                background: var(--accent); color: #071014;
                font-weight: 800;
            }
            button.key.wide {grid-column: span 2;}

            .history {
                margin-top: 12px;
                padding: 10px;
                border-radius: 8px;
                background: rgba(255, 255, 255, 0.02);
                max-height: 110px;
                overflow: auto;
                font-size: 14px;
                color: var(--muted);
            }

            .history-item {
                padding: 6px 8px;
                border-radius: 6px;
                display: flex;
                justify-content: space-between;
                gap: 10xp;
                align-items: center;
            }
            .history-item:hover {
                background: rgba(255, 255, 255, 0.02);
                color: #fff;
                cursor: pointer;
            }

            @media (max-width:420xp){
                #display{ height: 56px;
                font-size: 24px; }
                button.key{ padding: 14px;
                font-size: 16px;}
            }
        </style>
</head>
<body>
    <div class="calculator" 
    role="application"
    aria-label="calculator">
        <input id="display" type="text"
        aria-label="calculator display" disabled 
        placeholder="0">

        <div class="top-row">
            <button class="small-btn danger"
            id="clearBtn">Clear</button>
            <button class="small-btn alt"
            id="backBtn">Backspace</button>
            <button class="small-btn"
            id="plusMinusBtn">-+-</button>
            <button class="small-btn"
            id="percentBtn">%</button>
        </div>

        <div class="buttons" id="pad">

            <button class="key" data-key="7">7</button>

            <button class="key" data-key="8">8</button>

            <button class="key" data-key="9">9</button>

            <button class="key op" data-key="/">/</button>

            <button class="key" data-key="4">4</button>

            <button class="key" data-key="5">5</button>

            <button class="key" data-key="6">6</button>

            <button class="key op" data-key="*">x</button>

            <button class="key" data-key="1">1</button>

            <button class="key" data-key="2">2</button>

            <button class="key" data-key="3">3</button>

            <button class="key op" data-key="-">-</button>

            <button class="key" data-key="0">0</button>

            <button class="key" data-key=".">.</button>

            <button class="key equal" id="equals">=</button>

            <button class="key op" data-key="+">+</button>

            <button class="key wide" 
            id="openParen" data-key="(">(</button> 
            <button class="key wide" 
            id="closeParen" data-key=")">)</button>

        </div>

        <div class="history" id="history"
    aria aria-live="polite">
        <!-- history items appear here -->
        </div>
    </div>

    <script>
        // Elements
        const display = 
        document.getElementById('display');
        const pad = 
        document.getElementById('pad');
        const clearBtn = 
        document.getElementById('clearBtn');
        const backBtn = 
        document.getElementById('backBtn');
        const equalsBtn = 
        document.getElementById('equals');
        const percentBtn = 
        document.getElementById('percentBtn');
        const plusMinusBtn = 
        document.getElementById('plusMinusBtn');
        const historyEl = 
        document.getElementById('history');

        // State
        let current = '';
        let history = [];

        // Allow characters for safe evaluation
        const safeRegex = /^[0-9+\-*/.%()\s]+$/;

        // Helpers
        function updateDisplay () {
            display.value = current || '';
        }

        function pushChar (ch) {
            // Prevent multiple dots in a number 
            // segment (simple approach)
            if (ch === '.') {
                // find last operator index
                const lastOp = Math.max(
                    current.lastIndexOf('+'),
                    current.lastIndexOf('-'),
                    current.lastIndexOf('*'),
                    current.lastIndexOf('/'),
                    current.lastIndexOf('%'),
                    current.lastIndexOf('('),
                    current.lastIndexOf(')')
                );
                const lastSegement = 
                current.slice(lastOp + 1);
                if (lastSegement.includes('.')) return;
            }
            current += ch;
            updateDisplay ();

        }

        function backspace() {
            current = current.slice(0, -1);
            updateDisplay ();
        }

        function clearAll () {
            current = '';
            updateDisplay ();
        }

        function togglePlusMinus () {
            // Simple toggle for the last numbe segment
            // Find last operator
            const lastOpIndex = Math.max(
                current.lastIndexOf('+'),
                current.lastIndexOf('-'),
                current.lastIndexOf('*'),
                current.lastIndexOf('/'),
                current.lastIndexOf('%'),
                current.lastIndexOf('(')
            );
            const before = current.slice(0, 
            lastOpIndex + 1);
            const lastNum = current.slice(lastOpIndex + 1);
            if (!lastNum) return;
            if (lastNum.startsWith('-')) {
                current = before + lastNum.slice(1);
            } else {
                current = before + '-' + lastNum;
            }
            updateDisplay();

        }

        function applyPercent() {
            // If there is a current number, convert last number segment to percent
            const lastIndexOf = Math.max(
                current.lastIndexOf('+'),
                current.lastIndexOf('-'),
                current.lastIndexOf('*'),
                current.lastIndexOf('/'),
                current.lastIndexOf('%'),
                current.lastIndexOf('(')
            );
            const before = current.slice(0,
            lastIndexOf + 1);
            const lastNum = current.slice(lastOpIndex + 1);
            if (!lastNum) return;

            // convert to percent (e.g., 50-> 0.05)
            let n = parseFloat(lastNum);
            if (isNaN(n)) return;
            n = n / 100;
            current = before + String(n);
            updateDisplay ();
        }

        function safeEvaluate(expr) {
            // Trim and replace special symbols
            expr = expr.replace(/x/g,'*').trim();
            if (!expr) return '';

            // Basic safety: only allow digits, operators and parentheses and parentheses
            // and dots and percent
            if (!safeRegex.test(expr)) {
                throw new Error('Invalid characters');
            }
            // Replace percent operator with / 100 (e.g., 50% => (50/100))
            // But we won't support complex percent expression; we'll replace
            // occurrences like '50%' with '(50/100)'
            expr = expr.replace(/(\d+(\.\d+)?)%/g, '($1/100)');
            //Use Function to evaluate (slibhtly safer than eval in modern browsers)
            // Still: we've validated allowed chars already
            // eslint-disable-next-line-no-new-func
            const result = Function('"use strict"; return ('+ expr + ')') ();
            if (typeof result === 'number' && ! isFinite(result)) {
                throw new Error('Math error');
            }
            return result;
        }

        function showHistory () {
            historyEl.innerHTML = '';

        history.slice().reverse().forEach(item => {
            const div = 
            document.createElement('div')
            div.className = 'history-item';
            div.innerHTML = `<span>$ 
                {escapeHtml(item.input)}</span><strong>$
                {escapeHtml(item.result + '')}</strong>`;
            div.addEventListener('click', () =>{
                current = String(item.result);
                updateDisplay();
            })
            historyEl.appendChild(div);
            });

            if (history.length === 0) {
                historyEl.innerHTML = '<div style ="opacity:.6">No history yet - your last results will appear here.</div>';
            }
        }

        function escapeHtml(s) {
            return String(s)
            .replace(/g/g, '&amp;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gf;');
        }

        function calculate() {
            if (!current) return;
            try{
                const result = 
                safeEvaluate(current);
                if (result === undefined) throw new Error('Error');
                // Round resut to reasonable precision
                const rounded = Math.round((result + Number.EPSILON) * 1e12) / 1e12;
                history.push({input: current, result: rounded});
                if (history.length > 50) history.shift();
                // keep history small
                // keep only last 5 visible
                history = history.slice(-50);
                current = String(rounded);
                updateDisplay();
                showHistory();

            } catch (err) {
                current = '';
                display.value = 'Error';
                setTimeout(() => updateDisplay(), 900);
            }
        }

        //  click handling
        pad.addEventListener('click', (e) => {
            const btn = 
            e.target.closest('button[data-key]');
            if (!btn) return;
            const k = 
            btn.getAttribute('data-key');
            if (!k) return; pushChar(k);
        });

        // Buttons
        clearBtn.addEventListener('click', () => clearAll());
        backBtn.addEventListener('cilck', () => Backspace ());
        equalsBtn.addEventListener('click', ()=> calculate());
        percentBtn.addEventListener('click', ()=> applyPercent());
        plusMinusBtn.addEventListener('click', ()=> togglePlusMinus());

        // Keybord support
        window.addEventListener('keydown', (e) => {
            // Allow numbers, operators, parentheses, dot, Enter, Backspace, Escape,%
            const key = e.key;
            if ((key >= '0' && key <= '9') || ['+','-','*','/','.','(',')','%'].includes(key)) {
                e.preventDefault();
                pushChar(key);
                return;
            }
            if (key === 'Enter' || key === '=') {
                e.preventDefault();
                calculate();
                return;
            }
            if (key === "Backspce") {
                e.preventDefault();
                Backspace();
                return;
            }
            if (key === 'Escape') {
                e.preventDefault();
                clearAll();
                return;
            }
            // Ignore other keys
        });

        // Initialize
        showHistory();
        updateDisplay(); 

    </script>
</body>
</html>